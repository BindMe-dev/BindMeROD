<!DOCTYPE html>
<html>
<head>
    <title>Debug Login Frontend</title>
</head>
<body>
    <h1>Debug Login Test</h1>
    <button onclick="testLogin()">Test Login Flow</button>
    <div id="output"></div>

    <script>
        async function testLogin() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Starting login test...</p>';
            
            try {
                // Test login API
                console.log('[DEBUG] Starting login API call');
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        identifier: 'n.ouladsalah@gmail.com',
                        password: 'MotherLand064861!'
                    })
                });
                
                console.log('[DEBUG] Login response status:', loginResponse.status);
                
                if (!loginResponse.ok) {
                    const error = await loginResponse.json();
                    output.innerHTML += '<p style="color: red;">❌ Login failed: ' + error.error + '</p>';
                    return;
                }
                
                const loginData = await loginResponse.json();
                console.log('[DEBUG] Login successful, user:', loginData.user?.email);
                output.innerHTML += '<p style="color: green;">✅ Login successful for: ' + loginData.user?.email + '</p>';
                
                // Test if we can access dashboard
                console.log('[DEBUG] Testing dashboard access');
                const dashboardResponse = await fetch('/dashboard', {
                    credentials: 'include'
                });
                
                console.log('[DEBUG] Dashboard response status:', dashboardResponse.status);
                
                if (dashboardResponse.ok) {
                    output.innerHTML += '<p style="color: green;">✅ Dashboard accessible</p>';
                    output.innerHTML += '<p><a href="/dashboard" target="_blank">Open Dashboard</a></p>';
                } else {
                    output.innerHTML += '<p style="color: red;">❌ Dashboard not accessible: ' + dashboardResponse.status + '</p>';
                }
                
                // Test auth/me
                console.log('[DEBUG] Testing auth/me');
                const meResponse = await fetch('/api/auth/me', {
                    credentials: 'include'
                });
                
                const meData = await meResponse.json();
                console.log('[DEBUG] Auth/me response:', meData);
                
                if (meData.user) {
                    output.innerHTML += '<p style="color: green;">✅ Auth/me working for: ' + meData.user.email + '</p>';
                } else {
                    output.innerHTML += '<p style="color: red;">❌ Auth/me returned no user</p>';
                }
                
            } catch (error) {
                console.error('[DEBUG] Error:', error);
                output.innerHTML += '<p style="color: red;">❌ Error: ' + error.message + '</p>';
            }
        }
    </script>
</body>
</html>